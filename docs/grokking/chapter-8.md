# 设计一个类似YouTube的视频共享服务

**类似服务**：netflix.com, vimeo.com, dailymotion.com, veoh.com  
**难度级别**：中等

## 1. 为什么是YouTube？
YouTube是全球最受欢迎的视频共享网站之一。用户可以在平台上上传、观看、分享、评分和举报视频，还可以在视频下添加评论。

## 2. 系统的需求和目标
为了简化设计，以下是我们要构建的一个简化版YouTube的需求：

**功能性需求：**

1. 用户应能上传视频。
2. 用户应能分享和观看视频。
3. 用户应能根据视频标题进行搜索。
4. 系统应能记录视频的统计数据，例如点赞/点踩数量、观看次数等。
5. 用户应能在视频下添加和查看评论。

**非功能性需求：**  

1. 系统应具有高可靠性，确保任何上传的视频都不会丢失。
2. 系统应具有高可用性。为了保证可用性，允许牺牲一定程度的一致性；若用户暂时无法看到某个视频，可以接受。
3. 用户在观看视频时应有实时体验，不应感到任何延迟。

**不在范围内：** 视频推荐、最受欢迎的视频、频道、订阅、稍后观看、收藏夹等功能。

## 3. 容量估算与约束

假设我们有15亿总用户，其中8亿是日活跃用户。如果平均每个用户每天观看5个视频，那么总视频观看量每秒将为：

`800M * 5 / 86400秒 ≈ 46K视频/秒`

假设我们的视频上传与观看比为1:200，即每上传一个视频有200次观看，这样每秒有230个视频上传：

`46K / 200 ≈ 230视频/秒`

**存储估算**：假设每分钟有500小时的视频上传到YouTube。如果平均每分钟视频需要50MB的存储空间（视频需要存储为多种格式），那么每分钟上传视频所需的总存储量为：

`500小时 * 60分钟 * 50MB ≈ 1500 GB/分钟（25 GB/秒）`

以上估算未考虑视频压缩和复制，这些因素会影响我们的估算结果。

**带宽估算**：每分钟上传500小时视频，假设每分钟的视频上传占用10MB带宽，我们每分钟的上传量将为300GB：

`500小时 * 60分钟 * 10MB ≈ 300GB/分钟（5GB/秒）`

假设上传与观看的比率为1:200，我们每秒需要1TB的输出带宽。
