# 设计 Facebook 的新闻推送  

让我们设计 Facebook 的新闻推送，该功能将包含用户关注的所有人和页面的帖子、照片、视频以及状态更新。  
类似服务：Twitter 新闻推送、Instagram 新闻推送、Quora 新闻推送  

难度等级：困难  

## 1. Facebook 的新闻源（Newsfeed）是什么？  
新闻源是 Facebook 主页中间不断更新的故事列表，其中包含用户关注的好友、页面和群组发布的状态更新、照片、视频、链接、应用活动及“点赞”等内容。换句话说，新闻源是一个完整、可滚动的动态流，展示了用户及其好友的生活记录，包括照片、视频、位置、状态更新等。  
对于任何社交媒体平台（如 Twitter、Instagram 或 Facebook），都需要一个新闻源系统来展示好友和关注者的动态更新。  

## 2. 系统的需求和目标  
我们设计一个 Facebook 的新闻源系统，要求如下：  

**功能性需求**  
1. 新闻源基于用户关注的好友、页面和群组的动态生成。  
2. 用户可能拥有大量好友，并关注众多页面和群组。  
3. 新闻源内容可能包含图片、视频或纯文本。  
4. 需要支持实时向所有活跃用户的新闻源中追加新动态。  

**非功能性需求**  
1. 系统应能够实时生成用户的新闻源，用户端的最大可接受延迟为 2 秒。  
2. 一条动态应在 5 秒内出现在用户的新闻源中（假设用户在此时请求新的新闻源）。  

## 3. 容量估算与约束  
假设每位用户平均拥有 300 个好友，并关注 200 个页面。  

**流量估算**  
假设每日活跃用户数为 3 亿，每位用户平均每天请求新闻源 5 次，这将产生 **15 亿次新闻源请求/天**，即 **每秒约 17,500 次请求**。  

**存储估算**  
假设我们需要在每位用户的新闻源中保留 500 条动态，并且每条动态平均占用 1KB 存储空间。  
- 每位用户的新闻源数据量 ≈ **500KB**  
- 需要存储所有活跃用户的数据 ≈ **150TB**  
- 如果每台服务器可存储 **100GB** 数据，则需要 **约 1500 台服务器** 来缓存所有活跃用户的前 500 条动态。
