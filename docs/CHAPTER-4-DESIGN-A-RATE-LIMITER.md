# 第四章：设计一个限流器  (Design A Rate Limiter)

在网络系统中，限流器（Rate Limiter）用于控制由客户端或服务发出的流量速率。在HTTP协议中，限流器限制客户端在特定时间段内允许发送的请求数量。如果API请求数量超过限流器定义的阈值，超出的请求将被阻止。以下是几个例子：

- 一个用户每秒最多可以发布2条帖子。
- 同一IP地址每天最多可以创建10个账户。
- 同一设备每周最多可以领取5次奖励。

在本章中，你将被要求设计一个限流器。在开始设计之前，我们先来看看使用API限流器的好处：

- **防止资源耗尽，避免拒绝服务攻击（DoS）**：几乎所有的大型科技公司公开的API都实施了某种形式的限流。例如，Twitter限制每3小时内最多发送300条推文。Google Docs API的默认限制是：每位用户每60秒最多发送300次读取请求。限流器通过阻止超出阈值的请求，防止有意或无意的DoS攻击。

- **降低成本**：限制多余的请求意味着需要的服务器数量更少，从而可以将更多资源分配给优先级较高的API。对于使用付费第三方API的公司来说，限流尤其重要。例如，某些外部API（如信用检查、支付处理、健康记录查询等）按调用次数收费，因此限制调用次数对降低成本至关重要。

- **防止服务器过载**：为了减少服务器负载，限流器用于过滤掉由机器人或用户不当行为导致的多余请求。

通过这些例子和好处，你可以了解到限流器的重要性。在设计限流器时，我们需要考虑到如何在高效的基础上确保系统的稳定性与安全性。
